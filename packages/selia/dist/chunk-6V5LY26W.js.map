{"version":3,"sources":["../src/lib/install-dependencies.ts"],"sourcesContent":["import { execa } from 'execa';\nimport { detectPackageManager, getInstallCommand } from './package-manager';\nimport { spinner } from '@clack/prompts';\nimport {\n  isPnpmWorkspaceRoot,\n  isSinglePackageWorkspace,\n} from '~/lib/check-workspace';\n\nexport async function installDependencies(\n  packages: Record<string, string>,\n  cwd: string = process.cwd(),\n): Promise<void> {\n  if (Object.keys(packages).length === 0) return;\n\n  const pm = await detectPackageManager(cwd);\n  const packagesString = Object.entries(packages)\n    .map(([pkg, version]) => `${pkg}@${version}`)\n    .join(' ');\n\n  const s = spinner();\n  s.start(`Installing dependencies with ${pm}...`);\n\n  try {\n    const [command, ...args] = getInstallCommand(pm).split(' ');\n\n    if (pm === 'pnpm' && (await isPnpmWorkspaceRoot(cwd))) {\n      if (!(await isSinglePackageWorkspace(cwd))) {\n        throw new Error('You need to install dependencies manually.');\n      }\n\n      args.push('-w');\n    }\n\n    await execa(command, [...args, ...packagesString.split(' ')], {\n      cwd,\n      args,\n      stdio: 'pipe',\n    });\n\n    s.stop('Dependencies installed');\n  } catch (error) {\n    s.stop('Failed to install dependencies');\n    throw new Error(\n      `${error instanceof Error ? error.message : 'Unknown error'}`,\n    );\n  }\n}\n"],"mappings":";;;;;;;;;;AAAA,SAAS,aAAa;AAEtB,SAAS,eAAe;AAMxB,eAAsB,oBACpB,UACA,MAAc,QAAQ,IAAI,GACX;AACf,MAAI,OAAO,KAAK,QAAQ,EAAE,WAAW,EAAG;AAExC,QAAM,KAAK,MAAM,qBAAqB,GAAG;AACzC,QAAM,iBAAiB,OAAO,QAAQ,QAAQ,EAC3C,IAAI,CAAC,CAAC,KAAK,OAAO,MAAM,GAAG,GAAG,IAAI,OAAO,EAAE,EAC3C,KAAK,GAAG;AAEX,QAAM,IAAI,QAAQ;AAClB,IAAE,MAAM,gCAAgC,EAAE,KAAK;AAE/C,MAAI;AACF,UAAM,CAAC,SAAS,GAAG,IAAI,IAAI,kBAAkB,EAAE,EAAE,MAAM,GAAG;AAE1D,QAAI,OAAO,UAAW,MAAM,oBAAoB,GAAG,GAAI;AACrD,UAAI,CAAE,MAAM,yBAAyB,GAAG,GAAI;AAC1C,cAAM,IAAI,MAAM,4CAA4C;AAAA,MAC9D;AAEA,WAAK,KAAK,IAAI;AAAA,IAChB;AAEA,UAAM,MAAM,SAAS,CAAC,GAAG,MAAM,GAAG,eAAe,MAAM,GAAG,CAAC,GAAG;AAAA,MAC5D;AAAA,MACA;AAAA,MACA,OAAO;AAAA,IACT,CAAC;AAED,MAAE,KAAK,wBAAwB;AAAA,EACjC,SAAS,OAAO;AACd,MAAE,KAAK,gCAAgC;AACvC,UAAM,IAAI;AAAA,MACR,GAAG,iBAAiB,QAAQ,MAAM,UAAU,eAAe;AAAA,IAC7D;AAAA,EACF;AACF;","names":[]}