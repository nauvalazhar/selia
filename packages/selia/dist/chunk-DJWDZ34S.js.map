{"version":3,"sources":["../src/commands/build.ts"],"sourcesContent":["import { Command } from 'commander';\nimport { intro, outro, log } from '@clack/prompts';\nimport fs from 'fs/promises';\nimport picocolors from 'picocolors';\nimport { RegistrySchema } from '../schemas/registry-schema';\nimport { isRegistryExists } from '~/lib/utils';\nimport { cleanBuild } from '~/lib/clean-build';\nimport { buildRegistry } from '../lib/build-registry';\n\nexport const buildCommand = new Command()\n  .name('build')\n  .description('Build the registry')\n  .option('-o, --output <path>', 'Output directory', './public/registry')\n  .action(async (options) => {\n    intro('Build Registry');\n\n    try {\n      // Check if registry exists\n      if (!(await isRegistryExists())) {\n        log.error(picocolors.red('Registry file not found: registry.json'));\n        process.exit(1);\n      }\n\n      // Read and parse registry\n      const registryContent = await fs.readFile('./registry.json', 'utf-8');\n      const parsedRegistry = JSON.parse(registryContent);\n\n      // Validate registry\n      const validatedRegistry = RegistrySchema.safeParse(parsedRegistry);\n\n      if (!validatedRegistry.success) {\n        console.log(validatedRegistry.error);\n        log.error(picocolors.red('Invalid registry format:'));\n        validatedRegistry.error.issues.forEach((err) => {\n          log.error(\n            picocolors.red(`  - ${err.path.join('.')}: ${err.message}`),\n          );\n        });\n        process.exit(1);\n      }\n\n      // Clean output directory\n      await cleanBuild(options.output);\n\n      // Build registry\n      await buildRegistry(validatedRegistry.data, {\n        output: options.output,\n      });\n\n      outro(picocolors.green('Registry built successfully! âœ“'));\n    } catch (error) {\n      log.error(\n        picocolors.red(\n          error instanceof Error ? error.message : 'An unknown error occurred',\n        ),\n      );\n      process.exit(1);\n    }\n  });\n"],"mappings":";;;;;;;;;;;;;;AAAA,SAAS,eAAe;AACxB,SAAS,OAAO,OAAO,WAAW;AAClC,OAAO,QAAQ;AACf,OAAO,gBAAgB;AAMhB,IAAM,eAAe,IAAI,QAAQ,EACrC,KAAK,OAAO,EACZ,YAAY,oBAAoB,EAChC,OAAO,uBAAuB,oBAAoB,mBAAmB,EACrE,OAAO,OAAO,YAAY;AACzB,QAAM,gBAAgB;AAEtB,MAAI;AAEF,QAAI,CAAE,MAAM,iBAAiB,GAAI;AAC/B,UAAI,MAAM,WAAW,IAAI,wCAAwC,CAAC;AAClE,cAAQ,KAAK,CAAC;AAAA,IAChB;AAGA,UAAM,kBAAkB,MAAM,GAAG,SAAS,mBAAmB,OAAO;AACpE,UAAM,iBAAiB,KAAK,MAAM,eAAe;AAGjD,UAAM,oBAAoB,eAAe,UAAU,cAAc;AAEjE,QAAI,CAAC,kBAAkB,SAAS;AAC9B,cAAQ,IAAI,kBAAkB,KAAK;AACnC,UAAI,MAAM,WAAW,IAAI,0BAA0B,CAAC;AACpD,wBAAkB,MAAM,OAAO,QAAQ,CAAC,QAAQ;AAC9C,YAAI;AAAA,UACF,WAAW,IAAI,OAAO,IAAI,KAAK,KAAK,GAAG,CAAC,KAAK,IAAI,OAAO,EAAE;AAAA,QAC5D;AAAA,MACF,CAAC;AACD,cAAQ,KAAK,CAAC;AAAA,IAChB;AAGA,UAAM,WAAW,QAAQ,MAAM;AAG/B,UAAM,cAAc,kBAAkB,MAAM;AAAA,MAC1C,QAAQ,QAAQ;AAAA,IAClB,CAAC;AAED,UAAM,WAAW,MAAM,qCAAgC,CAAC;AAAA,EAC1D,SAAS,OAAO;AACd,QAAI;AAAA,MACF,WAAW;AAAA,QACT,iBAAiB,QAAQ,MAAM,UAAU;AAAA,MAC3C;AAAA,IACF;AACA,YAAQ,KAAK,CAAC;AAAA,EAChB;AACF,CAAC;","names":[]}