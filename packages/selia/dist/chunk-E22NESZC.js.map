{"version":3,"sources":["../src/commands/init.ts"],"sourcesContent":["import { Command } from 'commander';\nimport { intro, outro, log, spinner, note, confirm } from '@clack/prompts';\nimport picocolors from 'picocolors';\nimport { fetchSetup } from '~/lib/fetch-setup';\nimport {\n  executeSetup,\n  executeSetupActions,\n  previewSetupActions,\n} from '~/lib/setup-executor';\nimport { defaultConfig } from '~/lib/default-config';\nimport { resolveRegistry } from '~/lib/resolve-registry';\nimport { writeConfig } from '~/lib/write-config';\nimport { Config } from '~/schemas/config-schema';\nimport { abortIfCancel } from '~/lib/utils';\n\nexport const initCommand = new Command()\n  .name('init')\n  .description('Initialize Selia in your project')\n  .option('-r, --registry <url>', 'Registry URL')\n  .option('-y, --yes', 'Skip confirmation')\n  .action(async (options) => {\n    console.log();\n    intro(picocolors.bgBlue(picocolors.blackBright(' Initialize Selia ')));\n\n    if (options.registry) {\n      log.info(\n        'This feature is not available yet.\\nUse default Selia registry instead.',\n      );\n      console.log();\n      return;\n    }\n\n    try {\n      const { runtimeUrl, persist, existingConfig } = await resolveRegistry(\n        process.cwd(),\n        options.registry,\n      );\n\n      const registryUrl = runtimeUrl;\n      if (!registryUrl) {\n        outro('Cancelled.');\n        return;\n      }\n\n      const s = spinner();\n\n      // Fetch registry metadata\n      //   const registry = await fetchRegistry(registryUrl);\n\n      // Try to fetch setup.json\n      let setup;\n      try {\n        s.start('Fetching setup configuration...');\n        setup = await fetchSetup(registryUrl as string);\n        s.stop('Setup configuration loaded');\n      } catch (error) {\n        if (error instanceof Error) {\n          s.stop(error.message);\n          return;\n        }\n\n        s.stop('No setup configuration found');\n\n        const finalConfig = {\n          ...defaultConfig,\n          //   ...(persist && {\n          //     registries: {\n          //       default: 'selia',\n          //       sources: {\n          //         selia: {\n          //           name: registry.name,\n          //           url: registryUrl,\n          //         },\n          //       },\n          //     },\n          //   }),\n        } as Config;\n\n        await writeConfig(finalConfig);\n\n        outro(picocolors.green('Config created ✓'));\n        log.info(\n          'Run ' +\n            picocolors.cyan('selia add <component>') +\n            ' to add components',\n        );\n        console.log();\n        return;\n      }\n\n      // Execute setup prompts (Phase 1: Collect info)\n      const context = await executeSetup(setup);\n\n      // Preview actions\n      const actions = await previewSetupActions(setup, context);\n\n      // Always add config creation action\n      actions.unshift('Create `selia.json`');\n\n      // Show what will be done\n      console.log(); // spacing\n      log.info('I will now perform the following actions:');\n      actions.forEach((action) => {\n        console.log(picocolors.dim('  • ') + action);\n      });\n      console.log(); // spacing\n\n      // Confirm\n      if (!options.yes) {\n        const shouldContinue = await confirm({\n          message: 'Is this okay?',\n          initialValue: true,\n        });\n\n        abortIfCancel(shouldContinue);\n\n        if (!shouldContinue) {\n          outro('Cancelled. Nothing was done.');\n          process.exit(0);\n        }\n      }\n\n      // Execute actions (Phase 2: Do the work)\n      await executeSetupActions(setup, context);\n\n      // Build final config\n      const config = {\n        ...defaultConfig,\n        ...existingConfig,\n        // ...(persist && {\n        //   registries: {\n        //     default: 'selia',\n        //     sources: {\n        //       selia: {\n        //         name: registry.name,\n        //         url: registryUrl,\n        //       },\n        //     },\n        //   },\n        // }),\n      } as Config;\n\n      // Write config file\n      s.start('Creating config file...');\n      await writeConfig(config);\n      s.stop('Config file created');\n\n      // Show summary\n      note(picocolors.dim('Config saved to: ') + picocolors.cyan('selia.json'));\n\n      outro(picocolors.green('Selia initialized successfully! ✓'));\n      log.info(\n        'Run ' +\n          picocolors.cyan('selia add <component>') +\n          ' to add components',\n      );\n      console.log();\n    } catch (error) {\n      log.error(\n        error instanceof Error ? error.message : 'An unknown error occurred',\n      );\n      process.exit(1);\n    }\n  });\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,SAAS,eAAe;AACxB,SAAS,OAAO,OAAO,KAAK,SAAS,MAAM,eAAe;AAC1D,OAAO,gBAAgB;AAahB,IAAM,cAAc,IAAI,QAAQ,EACpC,KAAK,MAAM,EACX,YAAY,kCAAkC,EAC9C,OAAO,wBAAwB,cAAc,EAC7C,OAAO,aAAa,mBAAmB,EACvC,OAAO,OAAO,YAAY;AACzB,UAAQ,IAAI;AACZ,QAAM,WAAW,OAAO,WAAW,YAAY,oBAAoB,CAAC,CAAC;AAErE,MAAI,QAAQ,UAAU;AACpB,QAAI;AAAA,MACF;AAAA,IACF;AACA,YAAQ,IAAI;AACZ;AAAA,EACF;AAEA,MAAI;AACF,UAAM,EAAE,YAAY,SAAS,eAAe,IAAI,MAAM;AAAA,MACpD,QAAQ,IAAI;AAAA,MACZ,QAAQ;AAAA,IACV;AAEA,UAAM,cAAc;AACpB,QAAI,CAAC,aAAa;AAChB,YAAM,YAAY;AAClB;AAAA,IACF;AAEA,UAAM,IAAI,QAAQ;AAMlB,QAAI;AACJ,QAAI;AACF,QAAE,MAAM,iCAAiC;AACzC,cAAQ,MAAM,WAAW,WAAqB;AAC9C,QAAE,KAAK,4BAA4B;AAAA,IACrC,SAAS,OAAO;AACd,UAAI,iBAAiB,OAAO;AAC1B,UAAE,KAAK,MAAM,OAAO;AACpB;AAAA,MACF;AAEA,QAAE,KAAK,8BAA8B;AAErC,YAAM,cAAc;AAAA,QAClB,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAYL;AAEA,YAAM,YAAY,WAAW;AAE7B,YAAM,WAAW,MAAM,uBAAkB,CAAC;AAC1C,UAAI;AAAA,QACF,SACE,WAAW,KAAK,uBAAuB,IACvC;AAAA,MACJ;AACA,cAAQ,IAAI;AACZ;AAAA,IACF;AAGA,UAAM,UAAU,MAAM,aAAa,KAAK;AAGxC,UAAM,UAAU,MAAM,oBAAoB,OAAO,OAAO;AAGxD,YAAQ,QAAQ,qBAAqB;AAGrC,YAAQ,IAAI;AACZ,QAAI,KAAK,2CAA2C;AACpD,YAAQ,QAAQ,CAAC,WAAW;AAC1B,cAAQ,IAAI,WAAW,IAAI,WAAM,IAAI,MAAM;AAAA,IAC7C,CAAC;AACD,YAAQ,IAAI;AAGZ,QAAI,CAAC,QAAQ,KAAK;AAChB,YAAM,iBAAiB,MAAM,QAAQ;AAAA,QACnC,SAAS;AAAA,QACT,cAAc;AAAA,MAChB,CAAC;AAED,oBAAc,cAAc;AAE5B,UAAI,CAAC,gBAAgB;AACnB,cAAM,8BAA8B;AACpC,gBAAQ,KAAK,CAAC;AAAA,MAChB;AAAA,IACF;AAGA,UAAM,oBAAoB,OAAO,OAAO;AAGxC,UAAM,SAAS;AAAA,MACb,GAAG;AAAA,MACH,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAYL;AAGA,MAAE,MAAM,yBAAyB;AACjC,UAAM,YAAY,MAAM;AACxB,MAAE,KAAK,qBAAqB;AAG5B,SAAK,WAAW,IAAI,mBAAmB,IAAI,WAAW,KAAK,YAAY,CAAC;AAExE,UAAM,WAAW,MAAM,wCAAmC,CAAC;AAC3D,QAAI;AAAA,MACF,SACE,WAAW,KAAK,uBAAuB,IACvC;AAAA,IACJ;AACA,YAAQ,IAAI;AAAA,EACd,SAAS,OAAO;AACd,QAAI;AAAA,MACF,iBAAiB,QAAQ,MAAM,UAAU;AAAA,IAC3C;AACA,YAAQ,KAAK,CAAC;AAAA,EAChB;AACF,CAAC;","names":[]}