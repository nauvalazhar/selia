{"version":3,"sources":["../src/lib/resolve-dependencies.ts"],"sourcesContent":["import { Item } from '../schemas/item-schema';\nimport { fetchItem } from './fetch-item';\n\ninterface ResolvedDependencies {\n  items: Map<string, Item>; // name -> item\n  npmPackages: Record<string, string>; // package -> version\n}\n\nexport async function resolveDependencies(\n  items: Item[],\n  registryUrl: string,\n  visited: Set<string> = new Set(),\n): Promise<ResolvedDependencies> {\n  const result: ResolvedDependencies = {\n    items: new Map(),\n    npmPackages: {},\n  };\n\n  for (const item of items) {\n    // Skip if already processed\n    if (visited.has(item.name)) continue;\n    visited.add(item.name);\n\n    // Add current item\n    result.items.set(item.name, item);\n\n    // Collect npm dependencies\n    if (item.dependencies?.npm) {\n      Object.assign(result.npmPackages, item.dependencies.npm);\n    }\n\n    // Recursively fetch item dependencies\n    if (item.dependencies?.items && item.dependencies.items.length > 0) {\n      const depItems = await Promise.all(\n        item.dependencies.items.map((depName) =>\n          fetchItem(registryUrl, depName),\n        ),\n      );\n\n      const depResolved = await resolveDependencies(\n        depItems,\n        registryUrl,\n        visited,\n      );\n\n      // Merge results\n      for (const [name, depItem] of depResolved.items) {\n        result.items.set(name, depItem);\n      }\n      Object.assign(result.npmPackages, depResolved.npmPackages);\n    }\n  }\n\n  return result;\n}\n"],"mappings":";;;;;AAQA,eAAsB,oBACpB,OACA,aACA,UAAuB,oBAAI,IAAI,GACA;AAC/B,QAAM,SAA+B;AAAA,IACnC,OAAO,oBAAI,IAAI;AAAA,IACf,aAAa,CAAC;AAAA,EAChB;AAEA,aAAW,QAAQ,OAAO;AAExB,QAAI,QAAQ,IAAI,KAAK,IAAI,EAAG;AAC5B,YAAQ,IAAI,KAAK,IAAI;AAGrB,WAAO,MAAM,IAAI,KAAK,MAAM,IAAI;AAGhC,QAAI,KAAK,cAAc,KAAK;AAC1B,aAAO,OAAO,OAAO,aAAa,KAAK,aAAa,GAAG;AAAA,IACzD;AAGA,QAAI,KAAK,cAAc,SAAS,KAAK,aAAa,MAAM,SAAS,GAAG;AAClE,YAAM,WAAW,MAAM,QAAQ;AAAA,QAC7B,KAAK,aAAa,MAAM;AAAA,UAAI,CAAC,YAC3B,UAAU,aAAa,OAAO;AAAA,QAChC;AAAA,MACF;AAEA,YAAM,cAAc,MAAM;AAAA,QACxB;AAAA,QACA;AAAA,QACA;AAAA,MACF;AAGA,iBAAW,CAAC,MAAM,OAAO,KAAK,YAAY,OAAO;AAC/C,eAAO,MAAM,IAAI,MAAM,OAAO;AAAA,MAChC;AACA,aAAO,OAAO,OAAO,aAAa,YAAY,WAAW;AAAA,IAC3D;AAAA,EACF;AAEA,SAAO;AACT;","names":[]}