{"version":3,"sources":["../../src/lib/get-config.ts"],"sourcesContent":["import fs from 'fs/promises';\nimport { defaultConfig } from './default-config';\nimport defu from 'defu';\nimport { Config, ConfigSchema } from '../schemas/config-schema';\nimport { log } from '@clack/prompts';\nimport picocolors from 'picocolors';\n\nexport async function getConfig(): Promise<Config> {\n  const configPath = './selia.json';\n\n  if (\n    !(await fs\n      .access(configPath)\n      .then(() => true)\n      .catch(() => false))\n  ) {\n    log.message(picocolors.yellow('Config not found, using default config'));\n    return defaultConfig;\n  }\n\n  const config = await fs.readFile(configPath, 'utf-8');\n\n  const parsedConfig = JSON.parse(config);\n\n  const validatedConfig = ConfigSchema.safeParse(parsedConfig);\n\n  if (!validatedConfig.success) {\n    log.error(picocolors.red('Config is not valid'));\n    log.error(validatedConfig.error.message);\n    return defaultConfig;\n  }\n\n  return defu(parsedConfig, defaultConfig);\n}\n"],"mappings":";;;;;;;;AAAA,OAAO,QAAQ;AAEf,OAAO,UAAU;AAEjB,SAAS,WAAW;AACpB,OAAO,gBAAgB;AAEvB,eAAsB,YAA6B;AACjD,QAAM,aAAa;AAEnB,MACE,CAAE,MAAM,GACL,OAAO,UAAU,EACjB,KAAK,MAAM,IAAI,EACf,MAAM,MAAM,KAAK,GACpB;AACA,QAAI,QAAQ,WAAW,OAAO,wCAAwC,CAAC;AACvE,WAAO;AAAA,EACT;AAEA,QAAM,SAAS,MAAM,GAAG,SAAS,YAAY,OAAO;AAEpD,QAAM,eAAe,KAAK,MAAM,MAAM;AAEtC,QAAM,kBAAkB,aAAa,UAAU,YAAY;AAE3D,MAAI,CAAC,gBAAgB,SAAS;AAC5B,QAAI,MAAM,WAAW,IAAI,qBAAqB,CAAC;AAC/C,QAAI,MAAM,gBAAgB,MAAM,OAAO;AACvC,WAAO;AAAA,EACT;AAEA,SAAO,KAAK,cAAc,aAAa;AACzC;","names":[]}