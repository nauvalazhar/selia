{"version":3,"sources":["../src/lib/load-config.ts"],"sourcesContent":["import fs from 'fs/promises';\nimport path from 'path';\nimport { ConfigSchema, type Config } from '../schemas/config-schema';\nimport { defaultConfig } from '~/lib/default-config';\nimport defu from 'defu';\nimport { log } from '@clack/prompts';\nimport z from 'zod';\n\nexport async function loadConfig(cwd: string = process.cwd()): Promise<Config> {\n  const configPath = path.join(cwd, 'selia.json');\n\n  try {\n    const content = await fs.readFile(configPath, 'utf-8');\n    const data = JSON.parse(content);\n\n    const merged = defu(data, defaultConfig);\n\n    const config = ConfigSchema.parse(merged);\n\n    log.info(`Loaded config from ${path.relative(cwd, configPath)}`);\n\n    return config;\n  } catch (error) {\n    if (error instanceof Error && 'code' in error && error.code === 'ENOENT') {\n      log.warn(\n        `No config file found at ${path.relative(cwd, configPath)} (using default config)`,\n      );\n\n      return defaultConfig;\n    }\n\n    if (error instanceof SyntaxError) {\n      throw new Error(\n        `Invalid JSON in config file ${configPath}: ${error.message}`,\n      );\n    }\n\n    if (error instanceof z.ZodError) {\n      throw new Error(\n        `Invalid config format:\\n${error.issues.map((e) => `  - ${e.path.join('.')}: ${e.message}`).join('\\n')}`,\n      );\n    }\n\n    throw new Error(\n      `Failed to load config from ${configPath}: ${error instanceof Error ? error.message : 'Unknown error'}`,\n    );\n  }\n}\n"],"mappings":";;;;;;;;AAAA,OAAO,QAAQ;AACf,OAAO,UAAU;AAGjB,OAAO,UAAU;AACjB,SAAS,WAAW;AACpB,OAAO,OAAO;AAEd,eAAsB,WAAW,MAAc,QAAQ,IAAI,GAAoB;AAC7E,QAAM,aAAa,KAAK,KAAK,KAAK,YAAY;AAE9C,MAAI;AACF,UAAM,UAAU,MAAM,GAAG,SAAS,YAAY,OAAO;AACrD,UAAM,OAAO,KAAK,MAAM,OAAO;AAE/B,UAAM,SAAS,KAAK,MAAM,aAAa;AAEvC,UAAM,SAAS,aAAa,MAAM,MAAM;AAExC,QAAI,KAAK,sBAAsB,KAAK,SAAS,KAAK,UAAU,CAAC,EAAE;AAE/D,WAAO;AAAA,EACT,SAAS,OAAO;AACd,QAAI,iBAAiB,SAAS,UAAU,SAAS,MAAM,SAAS,UAAU;AACxE,UAAI;AAAA,QACF,2BAA2B,KAAK,SAAS,KAAK,UAAU,CAAC;AAAA,MAC3D;AAEA,aAAO;AAAA,IACT;AAEA,QAAI,iBAAiB,aAAa;AAChC,YAAM,IAAI;AAAA,QACR,+BAA+B,UAAU,KAAK,MAAM,OAAO;AAAA,MAC7D;AAAA,IACF;AAEA,QAAI,iBAAiB,EAAE,UAAU;AAC/B,YAAM,IAAI;AAAA,QACR;AAAA,EAA2B,MAAM,OAAO,IAAI,CAAC,MAAM,OAAO,EAAE,KAAK,KAAK,GAAG,CAAC,KAAK,EAAE,OAAO,EAAE,EAAE,KAAK,IAAI,CAAC;AAAA,MACxG;AAAA,IACF;AAEA,UAAM,IAAI;AAAA,MACR,8BAA8B,UAAU,KAAK,iBAAiB,QAAQ,MAAM,UAAU,eAAe;AAAA,IACvG;AAAA,EACF;AACF;","names":[]}