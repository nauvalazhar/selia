{"version":3,"sources":["../src/schemas/setup-schema.ts"],"sourcesContent":["import { z } from 'zod';\n\nconst ConditionAtomSchema = z.discriminatedUnion('type', [\n  z.object({\n    type: z.literal('file-exists'),\n    path: z.string(),\n  }),\n\n  z.object({\n    type: z.literal('file-contains'),\n    path: z.string(),\n    pattern: z.string(),\n  }),\n\n  z.object({\n    type: z.literal('dependency'),\n    name: z.string(),\n  }),\n\n  z.object({\n    type: z.literal('env'),\n    key: z.string(),\n  }),\n\n  z.object({\n    type: z.literal('framework'),\n    value: z.string(),\n  }),\n]);\n\nconst ConditionSchema: z.ZodType<any> = z.lazy(() =>\n  z.union([\n    ConditionAtomSchema,\n\n    z.object({\n      all: z.array(ConditionSchema),\n    }),\n\n    z.object({\n      any: z.array(ConditionSchema),\n    }),\n\n    z.object({\n      not: ConditionSchema,\n    }),\n  ]),\n);\n\nconst BaseStepSchema = z.object({\n  condition: z\n    .object({\n      if: ConditionSchema.optional(),\n      unless: ConditionSchema.optional(),\n    })\n    .optional(),\n});\n\nexport const SetupStepSchema = z.discriminatedUnion('type', [\n  BaseStepSchema.extend({\n    type: z.literal('dependencies'),\n    packages: z.record(z.string(), z.string()),\n  }),\n\n  // Detect framework\n  BaseStepSchema.extend({\n    type: z.literal('detect-framework'),\n    name: z.string(),\n    saveAs: z.string().optional(),\n  }),\n\n  BaseStepSchema.extend({\n    type: z.literal('assert'),\n    name: z.string(),\n\n    check: z.discriminatedUnion('type', [\n      z.object({\n        type: z.literal('dependency'),\n        packages: z.array(z.string()),\n      }),\n\n      z.object({\n        type: z.literal('file-exists'),\n        path: z.string(),\n      }),\n\n      z.object({\n        type: z.literal('framework'),\n        value: z.array(z.string()),\n      }),\n\n      z.object({\n        type: z.literal('env'),\n        key: z.string(),\n      }),\n    ]),\n\n    onFail: z.object({\n      exit: z.boolean().default(true),\n      message: z.union([z.string(), z.array(z.string())]),\n    }),\n  }),\n\n  // Prompt\n  BaseStepSchema.extend({\n    type: z.literal('prompt'),\n    name: z.string(),\n    promptType: z.enum(['text', 'select', 'confirm', 'file-search']),\n    message: z.string(),\n    saveAs: z.string(), // where to save in config\n    default: z.any().optional(),\n    // For file-search\n    pattern: z.string().optional(),\n    exclude: z.array(z.string()).optional(),\n    // For select\n    options: z\n      .array(\n        z.object({\n          value: z.string(),\n          label: z.string(),\n        }),\n      )\n      .optional(),\n    // Validation\n    validate: z\n      .object({\n        pattern: z.string().optional(),\n        required: z.boolean().optional(),\n      })\n      .optional(),\n  }),\n\n  // File append\n  BaseStepSchema.extend({\n    type: z.literal('file-append'),\n    target: z.string(), // supports {{variable}}\n    content: z.string().optional(),\n    contentPath: z.string().optional(), // from registry\n  }),\n\n  // File create\n  BaseStepSchema.extend({\n    type: z.literal('file-create'),\n    target: z.string(),\n    content: z.string().optional(),\n    contentPath: z.string().optional(),\n    overwrite: z.boolean().optional().default(false),\n  }),\n\n  // File update\n  BaseStepSchema.extend({\n    type: z.literal('file-update'),\n    target: z.string(),\n    search: z.string(), // regex pattern\n    replace: z.string(), // replacement string\n  }),\n\n  // File update JSON\n  BaseStepSchema.extend({\n    type: z.literal('file-update-json'),\n    target: z.string(),\n    content: z.record(z.string(), z.any()),\n    merge: z.enum(['shallow', 'deep']).optional().default('deep'),\n  }),\n]);\n\nexport const SetupSchema = z.object({\n  steps: z.array(SetupStepSchema),\n});\n\nexport type SetupStep = z.infer<typeof SetupStepSchema>;\nexport type Setup = z.infer<typeof SetupSchema>;\n"],"mappings":"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","names":[]}